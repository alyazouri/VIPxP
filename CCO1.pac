function FindProxyForURL(url, host) {
  var h = host.toLowerCase();
  var u = url.toLowerCase();

  // ğŸ¯ Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª Ø£Ø±Ø¯Ù†ÙŠØ© Ù…ØªØ®ØµØµØ©
  var PROXY_JO_MATCH = "PROXY 46.185.131.218:20001";
  var PROXY_JO_LOBBY = "PROXY 91.106.109.12:9030";
  var PROXY_ME_MIXED = "PROXY 176.29.153.95:20001";
  var BLOCK = "PROXY 127.0.0.1:1";

  // ğŸ“ Ù†Ø·Ø§Ù‚Ø§Øª IPv4 Ø£Ø±Ø¯Ù†ÙŠØ© Ø¨ÙŠÙˆØ± Ù„Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª
  var JORDAN_MATCH_IPV4 = [
    ["37.230.0.0", "255.254.0.0"],
    ["46.23.0.0", "255.255.0.0"],
    ["46.29.0.0", "255.255.252.0"],
    ["188.161.0.0", "255.255.252.0"],
    ["176.56.0.0", "255.248.0.0"],
    ["82.212.64.0", "255.255.192.0"],
    ["185.84.220.0", "255.255.252.0"],
    ["37.239.0.0", "255.255.254.0"],
    ["46.30.0.0", "255.255.254.0"],
    ["188.162.0.0", "255.255.254.0"],
    ["46.244.0.0", "255.252.0.0"],
    ["185.117.136.0", "255.255.248.0"],
    ["91.106.64.0", "255.255.192.0"]
  ];

  // ğŸŒ Ù†Ø·Ø§Ù‚Ø§Øª Ø´Ø±Ù‚ Ø£ÙˆØ³Ø· Ù…Ø®ØªÙ„Ø·Ø© (hop Ø£Ø±Ø¯Ù†ÙŠ + Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…Ù† Ø§Ù„Ù…Ù†Ø·Ù‚Ø©)
  var MIDDLEEAST_MATCH_IPV4 = [
    // Ø§Ù„Ø´Ø§Ù… (ÙÙ„Ø³Ø·ÙŠÙ†ØŒ Ø³ÙˆØ±ÙŠØ§ØŒ Ù„Ø¨Ù†Ø§Ù†) - hop Ø£Ø±Ø¯Ù†ÙŠ
    ["185.85.0.0", "255.255.0.0"],
    ["188.163.0.0", "255.255.252.0"],
    ["37.228.0.0", "255.252.0.0"],
    ["46.31.0.0", "255.255.254.0"],
    ["176.58.0.0", "255.254.0.0"],
    
    // Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© - Ù†Ø·Ø§Ù‚Ø§Øª Ù…Ø¹ hop Ø£Ø±Ø¯Ù†ÙŠ
    ["46.240.0.0", "255.248.0.0"],
    ["188.164.0.0", "255.252.0.0"],
    ["85.185.0.0", "255.255.0.0"],
    ["213.130.0.0", "255.254.0.0"],
    
    // Ø§Ù„Ø®Ù„ÙŠØ¬ (Ø§Ù„Ø¥Ù…Ø§Ø±Ø§ØªØŒ Ø§Ù„ÙƒÙˆÙŠØªØŒ Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†) - hop Ø£Ø±Ø¯Ù†ÙŠ
    ["5.62.0.0", "255.254.0.0"],
    ["94.201.0.0", "255.255.252.0"],
    ["213.42.0.0", "255.254.0.0"],
    
    // Ù…ØµØ± - hop Ø£Ø±Ø¯Ù†ÙŠ
    ["41.33.0.0", "255.255.0.0"],
    ["197.50.0.0", "255.254.0.0"],
    ["196.219.0.0", "255.255.0.0"],
    
    // Ø§Ù„Ø¹Ø±Ø§Ù‚ - hop Ø£Ø±Ø¯Ù†ÙŠ
    ["149.255.0.0", "255.255.0.0"],
    ["185.82.0.0", "255.254.0.0"],
    
    // Ù†Ø·Ø§Ù‚Ø§Øª Ø¥Ù‚Ù„ÙŠÙ…ÙŠØ© Ù…Ø®ØªÙ„Ø·Ø© - Ø¨Ø¯ÙˆÙ† hop Ø£ÙˆØ±ÙˆØ¨ÙŠ
    ["188.165.0.0", "255.255.0.0"],
    ["213.6.0.0", "255.254.0.0"]
  ];

  // ğŸ›ï¸ Ù†Ø·Ø§Ù‚Ø§Øª ÙˆØ§Ø³Ø¹Ø© Ù„Ù„ÙˆØ¨ÙŠ
  var LOBBY_IPV4 = [
    // Ø§Ù„Ø£Ø±Ø¯Ù†
    ["37.230.0.0", "255.254.0.0"],
    ["46.23.0.0", "255.255.0.0"],
    ["46.29.0.0", "255.255.0.0"],
    ["188.161.0.0", "255.255.0.0"],
    ["176.56.0.0", "255.248.0.0"],
    ["82.212.0.0", "255.255.0.0"],
    ["185.84.0.0", "255.252.0.0"],
    
    // Ø§Ù„Ø®Ù„ÙŠØ¬ ÙˆØ§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø·
    ["5.0.0.0", "255.128.0.0"],
    ["37.200.0.0", "255.240.0.0"],
    ["46.0.0.0", "255.128.0.0"],
    ["85.0.0.0", "255.128.0.0"],
    ["94.200.0.0", "255.248.0.0"],
    ["149.0.0.0", "255.128.0.0"],
    ["185.0.0.0", "255.128.0.0"],
    ["188.160.0.0", "255.240.0.0"],
    ["213.0.0.0", "255.128.0.0"],
    
    // Ù…ØµØ± ÙˆØ´Ù…Ø§Ù„ Ø£ÙØ±ÙŠÙ‚ÙŠØ§
    ["41.32.0.0", "255.224.0.0"],
    ["196.128.0.0", "255.128.0.0"],
    ["197.0.0.0", "255.128.0.0"]
  ];

  // âŒâŒâŒ Ø­Ø¸Ø± ÙƒØ§Ù…Ù„ - Ø£ÙˆØ±ÙˆØ¨Ø§ ÙˆØ£ÙØºØ§Ù†Ø³ØªØ§Ù† ÙˆÙ„ÙŠØ¨ÙŠØ§ ÙˆØ¥ÙŠØ±Ø§Ù† âŒâŒâŒ
  var BLOCKED_REGIONS_IPV4 = [
    // ========== Ø£ÙˆØ±ÙˆØ¨Ø§ Ø§Ù„ÙƒØ§Ù…Ù„Ø© ==========
    ["77.0.0.0", "255.0.0.0"],
    ["78.0.0.0", "255.128.0.0"],
    ["80.0.0.0", "255.192.0.0"],
    ["81.0.0.0", "255.0.0.0"],
    ["82.0.0.0", "255.128.0.0"],
    ["83.0.0.0", "255.0.0.0"],
    ["84.0.0.0", "255.0.0.0"],
    ["86.0.0.0", "255.0.0.0"],
    ["87.0.0.0", "255.0.0.0"],
    ["88.0.0.0", "255.0.0.0"],
    ["89.0.0.0", "255.0.0.0"],
    ["90.0.0.0", "255.0.0.0"],
    ["91.0.0.0", "255.0.0.0"],
    ["92.0.0.0", "255.0.0.0"],
    ["93.0.0.0", "255.0.0.0"],
    ["94.0.0.0", "255.128.0.0"],
    ["95.0.0.0", "255.0.0.0"],
    ["109.0.0.0", "255.0.0.0"],
    ["141.0.0.0", "255.0.0.0"],
    ["151.0.0.0", "255.128.0.0"],
    ["176.0.0.0", "255.128.0.0"],
    ["178.0.0.0", "255.0.0.0"],
    ["185.0.0.0", "255.128.0.0"],
    ["188.0.0.0", "255.128.0.0"],
    ["193.0.0.0", "255.0.0.0"],
    ["194.0.0.0", "255.0.0.0"],
    ["195.0.0.0", "255.0.0.0"],
    ["212.0.0.0", "255.0.0.0"],
    ["213.128.0.0", "255.128.0.0"],
    ["217.0.0.0", "255.0.0.0"],
    
    // ========== Ø£ÙØºØ§Ù†Ø³ØªØ§Ù† ğŸ‡¦ğŸ‡« ==========
    ["103.8.14.0", "255.255.254.0"],
    ["103.11.220.0", "255.255.252.0"],
    ["103.231.136.0", "255.255.248.0"],
    ["119.63.128.0", "255.255.128.0"],
    ["149.54.0.0", "255.254.0.0"],
    ["175.107.192.0", "255.255.192.0"],
    ["202.142.128.0", "255.255.192.0"],
    ["203.128.0.0", "255.248.0.0"],
    
    // ========== Ù„ÙŠØ¨ÙŠØ§ ğŸ‡±ğŸ‡¾ ==========
    ["41.208.64.0", "255.255.192.0"],
    ["41.252.0.0", "255.254.0.0"],
    ["82.137.192.0", "255.255.192.0"],
    ["154.127.0.0", "255.255.0.0"],
    ["160.202.0.0", "255.254.0.0"],
    ["196.12.128.0", "255.255.128.0"],
    ["196.223.0.0", "255.255.0.0"],
    ["197.215.0.0", "255.255.0.0"],
    
    // ========== Ø¥ÙŠØ±Ø§Ù† ğŸ‡®ğŸ‡· (ØªØºØ·ÙŠØ© Ø´Ø§Ù…Ù„Ø©) ==========
    ["2.144.0.0", "255.240.0.0"],
    ["5.22.0.0", "255.254.0.0"],
    ["5.26.0.0", "255.254.0.0"],
    ["5.34.0.0", "255.254.0.0"],
    ["5.42.0.0", "255.254.0.0"],
    ["5.52.0.0", "255.252.0.0"],
    ["5.56.0.0", "255.248.0.0"],
    ["5.64.0.0", "255.192.0.0"],
    ["5.104.0.0", "255.248.0.0"],
    ["5.112.0.0", "255.240.0.0"],
    ["5.144.0.0", "255.240.0.0"],
    ["5.160.0.0", "255.224.0.0"],
    ["5.200.0.0", "255.248.0.0"],
    ["31.2.128.0", "255.255.128.0"],
    ["31.7.64.0", "255.255.192.0"],
    ["31.14.0.0", "255.254.0.0"],
    ["31.24.0.0", "255.248.0.0"],
    ["31.40.0.0", "255.248.0.0"],
    ["31.56.0.0", "255.248.0.0"],
    ["37.9.0.0", "255.255.0.0"],
    ["37.32.0.0", "255.224.0.0"],
    ["37.75.0.0", "255.255.0.0"],
    ["37.98.0.0", "255.254.0.0"],
    ["37.114.0.0", "255.254.0.0"],
    ["37.130.0.0", "255.254.0.0"],
    ["37.143.0.0", "255.255.0.0"],
    ["37.153.128.0", "255.255.128.0"],
    ["37.156.0.0", "255.252.0.0"],
    ["37.191.0.0", "255.255.0.0"],
    ["37.235.0.0", "255.255.0.0"],
    ["45.8.144.0", "255.255.240.0"],
    ["45.15.200.0", "255.255.248.0"],
    ["45.82.136.0", "255.255.248.0"],
    ["45.89.136.0", "255.255.248.0"],
    ["45.129.36.0", "255.255.252.0"],
    ["45.133.168.0", "255.255.248.0"],
    ["45.139.100.0", "255.255.252.0"],
    ["45.146.164.0", "255.255.252.0"],
    ["45.159.200.0", "255.255.248.0"],
    ["46.18.0.0", "255.254.0.0"],
    ["46.20.0.0", "255.252.0.0"],
    ["46.32.0.0", "255.224.0.0"],
    ["46.100.0.0", "255.252.0.0"],
    ["46.104.0.0", "255.252.0.0"],
    ["46.143.0.0", "255.255.0.0"],
    ["46.148.0.0", "255.252.0.0"],
    ["46.224.0.0", "255.224.0.0"],
    ["62.60.128.0", "255.255.128.0"],
    ["78.38.0.0", "255.254.0.0"],
    ["78.110.0.0", "255.254.0.0"],
    ["78.153.0.0", "255.255.0.0"],
    ["79.127.0.0", "255.255.0.0"],
    ["79.132.192.0", "255.255.192.0"],
    ["79.143.0.0", "255.255.0.0"],
    ["79.175.128.0", "255.255.192.0"],
    ["80.66.176.0", "255.255.240.0"],
    ["80.75.0.0", "255.255.0.0"],
    ["80.191.0.0", "255.255.0.0"],
    ["80.242.0.0", "255.254.0.0"],
    ["80.253.128.0", "255.255.128.0"],
    ["81.12.0.0", "255.252.0.0"],
    ["81.16.0.0", "255.248.0.0"],
    ["81.28.32.0", "255.255.224.0"],
    ["81.31.160.0", "255.255.224.0"],
    ["81.90.144.0", "255.255.240.0"],
    ["81.91.128.0", "255.255.192.0"]
  ];

  // ğŸ” ÙƒØ´Ù PUBG
  if (!isPUBG(h)) {
    return PROXY_JO_LOBBY;
  }

  // ğŸ® Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª - Ø­Ù…Ø§ÙŠØ© Ù‚ØµÙˆÙ‰
  if (isMatch(u, h)) {
    // âŒ Ø§Ù„Ø­Ø¸Ø± Ù„Ù‡ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ù‚ØµÙˆÙ‰
    if (isInRanges(h, BLOCKED_REGIONS_IPV4)) {
      return BLOCK;
    }
    
    // âœ… Ù†Ø·Ø§Ù‚Ø§Øª Ø£Ø±Ø¯Ù†ÙŠØ© Ø¨ÙŠÙˆØ±
    if (isInRanges(h, JORDAN_MATCH_IPV4)) {
      return PROXY_JO_MATCH;
    }
    
    // âœ… Ù†Ø·Ø§Ù‚Ø§Øª Ø´Ø±Ù‚ Ø£ÙˆØ³Ø· Ù…Ø¹ hop Ø£Ø±Ø¯Ù†ÙŠ ÙÙ‚Ø·
    if (isInRanges(h, MIDDLEEAST_MATCH_IPV4)) {
      return PROXY_JO_MATCH + "; " + PROXY_ME_MIXED;
    }

    // Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª
    return PROXY_JO_MATCH;
  }

  // ğŸ›ï¸ Ø§Ù„Ù„ÙˆØ¨ÙŠ
  if (isLobby(u, h)) {
    // Ø­Ø¸Ø± Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù…Ù…Ù†ÙˆØ¹Ø©
    if (isInRanges(h, BLOCKED_REGIONS_IPV4)) {
      return BLOCK;
    }
    
    if (isInRanges(h, LOBBY_IPV4)) {
      return PROXY_JO_LOBBY;
    }
    return PROXY_JO_LOBBY;
  }

  // ğŸ‘¥ Ø§Ù„Ø³ÙˆØ´Ø§Ù„
  if (isSocial(u, h)) {
    if (isInRanges(h, BLOCKED_REGIONS_IPV4)) {
      return BLOCK;
    }
    return PROXY_JO_LOBBY;
  }

  // ğŸ“¦ CDN
  if (isCDN(u, h)) {
    return PROXY_JO_LOBBY;
  }

  // ğŸŒ Ø§ÙØªØ±Ø§Ø¶ÙŠ
  return PROXY_JO_LOBBY;
}

// ================= ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙƒØ´Ù =================
function isPUBG(h) {
  return /pubg|pubgm|tencent|krafton|lightspeed|levelinfinite|proximabeta|intlgame|qq|igamecj|anticheatexpert|game\.gtimg|dlied|tdm|cdn\.tencent|wetest/i.test(h);
}

function isMatch(u, h) {
  return /match|battle|game-|combat|realtime|sync|udp|tick|room|arena|fight|war|session|instance|server-|play-|pvp|versus/i.test(u + h);
}

function isLobby(u, h) {
  return /lobby|matchmaking|queue|dispatch|gateway|region|join|recruit|hall|waiting|prepare|login|auth|account|profile|inventory/i.test(u + h);
}

function isSocial(u, h) {
  return /friend|invite|squad|team|party|clan|presence|social|chat|voice|guild|group|message/i.test(u + h);
}

function isCDN(u, h) {
  return /cdn|asset|resource|patch|update|media|content|download|static|image|video|texture|model/i.test(u + h);
}

// ================= ÙØ­Øµ Ø§Ù„Ù†Ø·Ø§Ù‚Ø§Øª =================
function isInRanges(host, ranges) {
  var ip = getIPFromHost(host);
  if (!ip) return false;
  
  for (var i = 0; i < ranges.length; i++) {
    if (isInNet(ip, ranges[i][0], ranges[i][1])) {
      return true;
    }
  }
  return false;
}

function getIPFromHost(host) {
  if (/^\d+\.\d+\.\d+\.\d+$/.test(host)) {
    return host;
  }
  
  var ipMatch = host.match(/(\d+\.\d+\.\d+\.\d+)/);
  if (ipMatch) {
    return ipMatch[1];
  }
  
  return myIpAddress();
}
